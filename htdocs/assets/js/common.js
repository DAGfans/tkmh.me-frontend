(function(){var t,e,i,n=function(t,e){return function(){return t.apply(e,arguments)}},a=function(t,e){function i(){this.constructor=t}for(var n in e)o.call(e,n)&&(t[n]=e[n]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},o={}.hasOwnProperty;i=window.utils||{},window.utils=i,e=navigator.userAgent.toLowerCase(),i.isAndroid=e.indexOf("android")!==-1,i.isiPhone=e.indexOf("iphone")!==-1,i.isiPad=e.indexOf("ipad")!==-1,i.TRANSITION_END="transitionend webkitTransitionEnd mozTransitionEnd oTransitionEnd",i.preloadImg=function(t){var e;return e=new $.Deferred,$("<img>").one("load",function(t){return e.resolve()}).attr("src",t),e.promise()},i.getiOSVersion=function(){var t;return t=navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),[parseInt(t[1],10),parseInt(t[2],10),parseInt(t[3]||0,10)]},i.getAndroidVersion=function(){var t;return t=navigator.appVersion.match(/Android (\d+).(\d+).?(\d+)?;/),[parseInt(t[1],10),parseInt(t[2],10),parseInt(t[3]||0,10)]},i.zeroPadding=function(t,e){var i,n,a;for(t=""+t,i=n=0,a=e;0<=a?n<a:n>a;i=0<=a?++n:--n)t="0"+t;return t.slice(-e)},i.toCap=function(t){return t.charAt(0).toUpperCase()+t.slice(1)},i.windowScrollTween=null,i.windowScrollTweenTimer=null,i.windowScrollTo=function(t,e){var n,a;return null==e&&(e=1),n=$.Deferred(),null!=(a=i.windowScrollTween)&&a.kill(),null!=i.windowScrollTweenTimer&&(clearTimeout(i.windowScrollTweenTimer),i.windowScrollTweenTimer=null),i.windowScrollTween=TweenMax.to(window,e,{scrollTo:{y:t},overwrite:!0,ease:Expo.easeOut,onComplete:function(){return n.resolve()}}),i.windowScrollTweenTimer=setTimeout(function(){return i.windowScrollTween.play()},200),n.promise()},i.map=function(t,e,i,n,a,o){var r;if(null==o&&(o=!0),o===!0){if(t<e)return n;if(t>i)return a}return r=(a-n)/(i-e),(t-e)*r+n},window.PerlinNoise=new function(){var t,e,i,n;t=function(t){return t*t*t*(t*(6*t-15)+10)},i=function(t,e,i){return e+t*(i-e)},e=function(t,e,i,n){var a,o,r;return a=15&t,o=a<8?e:i,r=a<4?i:12===a||14===a?e:n,(0===(1&a)?o:-o)+(0===(2&a)?r:-r)},n=function(t){return(1+t)/2},this.noise=function(a,o,r){var s,h,u,l,c,d,m,f,p,b,g,v,y,w,H;for(null==o&&(o=0),null==r&&(r=0),g=new Array(512),v=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],b=0;b<256;)g[256+b]=g[b]=v[b],b++;return m=255&Math.floor(a),f=255&Math.floor(o),p=255&Math.floor(r),a-=Math.floor(a),o-=Math.floor(o),r-=Math.floor(r),y=t(a),w=t(o),H=t(r),s=g[m]+f,h=g[s]+p,u=g[s+1]+p,l=g[m+1]+f,c=g[l]+p,d=g[l+1]+p,n(i(H,i(w,i(y,e(g[h],a,o,r),e(g[c],a-1,o,r)),i(y,e(g[u],a,o-1,r),e(g[d],a-1,o-1,r))),i(w,i(y,e(g[h+1],a,o,r-1),e(g[c+1],a-1,o,r-1)),i(y,e(g[u+1],a,o-1,r-1),e(g[d+1],a-1,o-1,r-1)))))}},window.requestAnimationFrame=function(t){return function(){return window.requestAnimationFrame||function(t){return setTimeout(t,1e3/60)}}}(this)(),window.cancelAnimationFrame=function(t){return function(){return window.cancelAnimationFrame||function(t){return clearTimeout(t)}}}(this)(),window.isEnabledlog=!0,window.log=function(){return window.isEnabledlog?null!=window.console&&null!=window.console.log.bind?window.console.log.bind(window.console):window.alert:function(){}}(),console.log=function(){},console.info=function(){},console.warn=function(){},t=window.tkmh||{},window.tkmh=t,t.common=t.common||{},t.shader=t.shader||{},t.index=t.index||{},t.about=t.about||{},t.blog=t.blog||{},t.works=t.works||{},t.bookmarks=t.bookmarks||{},t.shader.hsv2rgb="vec3 hsv2rgb(vec3 c) {\n  vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\n  vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\n  return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n}",t.shader.map="float map(float value, float inputMin, float inputMax, float outputMin, float outputMax, bool clamp) {\n  if(clamp == true) {\n    if(value < inputMin) return outputMin;\n    if(value > inputMax) return outputMax;\n  }\n\n  float p = (outputMax - outputMin) / (inputMax - inputMin);\n  return ((value - inputMin) * p) + outputMin;\n}",t.shader.rotateVec3="vec3 rotateVec3(vec3 p, float angle, vec3 axis){\n  vec3 a = normalize(axis);\n  float s = sin(angle);\n  float c = cos(angle);\n  float r = 1.0 - c;\n  mat3 m = mat3(\n    a.x * a.x * r + c,\n    a.y * a.x * r + a.z * s,\n    a.z * a.x * r - a.y * s,\n    a.x * a.y * r - a.z * s,\n    a.y * a.y * r + c,\n    a.z * a.y * r + a.x * s,\n    a.x * a.z * r + a.y * s,\n    a.y * a.z * r - a.x * s,\n    a.z * a.z * r + c\n  );\n  return m * p;\n}",t.shader.easeInOutExpo="float easeInOutExpo(float t, float b, float c, float d) {\n  if (t == 0.0) return b;\n  if (t == d) return b+c;\n  if ((t /= d / 2.0) < 1.0) return c / 2.0 * pow(2.0, 10.0 * (t - 1.0)) + b;\n  return c / 2.0 * (-pow(2.0, -10.0 * --t) + 2.0) + b;\n}",t.shader.definePI="#define PI 3.1415926535897932384626433832795",t.shader.simplexNoise2D="vec3 mod289(vec3 x) {\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\n\nvec2 mod289(vec2 x) {\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\n\nvec3 permute(vec3 x) {\n  return mod289(((x*34.0)+1.0)*x);\n}\n\nfloat simplexNoise2D(vec2 v) {\n  const vec4 C = vec4(0.211324865405187,  // (3.0-sqrt(3.0))/6.0\n                      0.366025403784439,  // 0.5*(sqrt(3.0)-1.0)\n                     -0.577350269189626,  // -1.0 + 2.0 * C.x\n                      0.024390243902439); // 1.0 / 41.0\n  // First corner\n  vec2 i  = floor(v + dot(v, C.yy) );\n  vec2 x0 = v -   i + dot(i, C.xx);\n\n  // Other corners\n  vec2 i1;\n  //i1.x = step( x0.y, x0.x ); // x0.x > x0.y ? 1.0 : 0.0\n  //i1.y = 1.0 - i1.x;\n  i1 = (x0.x > x0.y) ? vec2(1.0, 0.0) : vec2(0.0, 1.0);\n  // x0 = x0 - 0.0 + 0.0 * C.xx ;\n  // x1 = x0 - i1 + 1.0 * C.xx ;\n  // x2 = x0 - 1.0 + 2.0 * C.xx ;\n  vec4 x12 = x0.xyxy + C.xxzz;\n  x12.xy -= i1;\n\n  // Permutations\n  i = mod289(i); // Avoid truncation effects in permutation\n  vec3 p = permute( permute( i.y + vec3(0.0, i1.y, 1.0 )) + i.x + vec3(0.0, i1.x, 1.0 ));\n\n  vec3 m = max(0.5 - vec3(dot(x0,x0), dot(x12.xy,x12.xy), dot(x12.zw,x12.zw)), 0.0);\n  m = m*m ;\n  m = m*m ;\n\n  // Gradients: 41 points uniformly over a line, mapped onto a diamond.\n  // The ring size 17*17 = 289 is close to a multiple of 41 (41*7 = 287)\n\n  vec3 x = 2.0 * fract(p * C.www) - 1.0;\n  vec3 h = abs(x) - 0.5;\n  vec3 ox = floor(x + 0.5);\n  vec3 a0 = x - ox;\n\n  // Normalise gradients implicitly by scaling m\n  // Approximation of: m *= inversesqrt( a0*a0 + h*h );\n  m *= 1.79284291400159 - 0.85373472095314 * ( a0*a0 + h*h );\n\n  // Compute final noise value at P\n  vec3 g;\n  g.x  = a0.x  * x0.x  + h.x  * x0.y;\n  g.yz = a0.yz * x12.xz + h.yz * x12.yw;\n  return 130.0 * dot(m, g);\n}",t.shader.TakumiShader={transparent:!0,uniforms:{time:{type:"f",value:0},ttlScale:{type:"f",value:1},animationParam1:{type:"f",value:0},animationParam2:{type:"f",value:0},animationParam3:{type:"f",value:0},animationParam4:{type:"f",value:0},animationParam5:{type:"f",value:0},animationParam6:{type:"f",value:0},animationParamTtlAbout:{type:"f",value:0},animationParamTtlBlog:{type:"f",value:0},animationParamTtlBookmarks:{type:"f",value:0},animationParamTtlWorks:{type:"f",value:0}},fragmentShader:"precision mediump float;\nvarying vec4 vColor;\n\nvoid main(){\n  gl_FragColor = vColor;\n}",vertexShader:"uniform mat4 modelViewMatrix;\nuniform mat4 modelMatrix;\nuniform mat4 projectionMatrix;\nuniform float time;\nuniform float ttlScale;\nuniform float animationParamDefault;\nuniform float animationParam1;\nuniform float animationParam2;\nuniform float animationParam3;\nuniform float animationParam4;\nuniform float animationParam5;\nuniform float animationParam6;\nuniform float animationParamTtlAbout;\nuniform float animationParamTtlBlog;\nuniform float animationParamTtlBookmarks;\nuniform float animationParamTtlWorks;\nattribute vec3 position;\nattribute vec3 cubeCenter;\nattribute vec3 cubeRandom;\nattribute vec3 triangleRandom;\nattribute vec3 triangleCenter;\nattribute vec3 normal;\nattribute float noiseValue;\nattribute float vertexIndex;\n\nattribute vec2 aboutPos;\nattribute vec2 blogPos;\nattribute vec2 bookmarksPos;\nattribute vec2 worksPos;\n\nvarying vec4 vColor;\n\n"+t.shader.definePI+"\n\n"+t.shader.easeInOutExpo+"\n\n"+t.shader.map+"\n\n"+t.shader.hsv2rgb+"\n\n"+t.shader.rotateVec3+"\n\nfloat getRad(float scale, float offset) {\n  return map(mod(time * scale + offset, PI * 2.0), 0.0, PI * 2.0, -PI, PI, true);\n}\n\nfloat getAnimationParam(float animationParam, float randomValue) {\n  float p = clamp(-map(randomValue, -1.0, 1.0, 0.0, 0.6, true) + animationParam * 1.5, 0.0, 1.0);\n  p = easeInOutExpo(p, 0.0, 1.0, 1.0);\n  return p;\n}\n\nvoid setTtlAnimation(float animationParam, vec2 ttlPos, inout vec3 pos) {\n  float p = getAnimationParam(animationParam, triangleRandom.x);\n  if(p > 0.0) {\n    pos = pos - triangleCenter * p;\n    pos *= (1.0 - 0.01 * p / ttlScale * cubeRandom.x);\n    float rad1 = getRad(40.0, noiseValue * 10.0);\n    float rad2 = getRad(40.0, noiseValue * 10.0);\n    pos = rotateVec3(pos, p * rad1, vec3(1.0, 0, 0));\n    pos = rotateVec3(pos, p * rad2, vec3(0, 1.0, 0));\n    pos.x *= 1.0 - p * 0.6;\n    pos.z *= 1.0 - p * 0.6;\n    vec3 n = rotateVec3(normal, p * rad1, vec3(1.0, 0, 0));\n    n = rotateVec3(n, p * rad2, vec3(0, 1.0, 0));\n    pos += (p * vec3(ttlPos * ttlScale, 0.0));\n  }\n}\n\nvoid main() {\n  vec3 pos = position;\n  vec3 n = normal;\n  float rad1, rad2;\n\n  // animation1\n  float p = easeInOutExpo(animationParam1, 0.0, 1.0, 1.0);\n  if(p > 0.0) {\n    rad1 = getRad(3.0, 0.0);\n    rad2 = getRad(5.0, 0.0);\n    pos = rotateVec3(pos, p * rad1, vec3(1.0, 0, 0));\n    pos = rotateVec3(pos, p * rad2, vec3(0, 1.0, 0));\n    n = rotateVec3(n, p * rad1, vec3(1.0, 0, 0));\n    n = rotateVec3(n, p * rad2, vec3(0, 1.0, 0));\n    pos += (p * sin(getRad(200.0, noiseValue * 200.0)) * noiseValue * 0.06 * normalize(pos));\n  }\n\n  // animation2\n  p = getAnimationParam(animationParam2, cubeRandom.x);\n  if(p > 0.0) {\n    pos = pos - cubeCenter * p;\n    pos *= (1.0 + p);\n    rad1 = PI * 2.0 * sin(getRad(1.0, cubeRandom.x));\n    rad2 = PI * 2.0 * sin(getRad(1.0, cubeRandom.y));\n    pos = rotateVec3(pos, p * rad1, vec3(1.0, 0, 0));\n    pos = rotateVec3(pos, p * rad2, vec3(0, 1.0, 0));\n    n = rotateVec3(n, p * rad1, vec3(1.0, 0, 0));\n    n = rotateVec3(n, p * rad2, vec3(0, 1.0, 0));\n    vec3 cubeCenterTo = cubeRandom * 20.0;\n    pos += (p * cubeCenterTo);\n    pos = rotateVec3(pos, p * getRad(1.0, 0.0), vec3(0.3, 1.0, 0.2));\n    pos += (p * sin(getRad(160.0, noiseValue * 160.0)) * noiseValue * 0.3 * normalize(cubeCenterTo - pos));\n  }\n\n\n  // animation3\n  p = getAnimationParam(animationParam3, triangleRandom.x);\n  if(p > 0.0) {\n    pos = pos - triangleCenter * p;\n    rad1 = getRad(40.0, triangleRandom.x);\n    rad2 = getRad(40.0, triangleRandom.y);\n    pos = rotateVec3(pos, p * rad1, vec3(1.0, 0, 0));\n    pos = rotateVec3(pos, p * rad2, vec3(0, 1.0, 0));\n    n = rotateVec3(n, p * rad1, vec3(1.0, 0, 0));\n    n = rotateVec3(n, p * rad2, vec3(0, 1.0, 0));\n    float radius = 30.0 * map(triangleRandom.y, -1.0, 1.0, 0.0, 1.0, true);\n    float anim2CircleRad = getRad(6.0, triangleRandom.x * 6.0);\n    pos += vec3(\n      p * radius * cos(anim2CircleRad),\n      p * 2.0 * sin(getRad(4.0, triangleRandom.y) * 10.0),\n      p * radius * sin(anim2CircleRad)\n    );\n    pos = rotateVec3(pos, p * getRad(4.0, 0.0), vec3(0.3, 1.0, sin(time)));\n    n = rotateVec3(n, p * getRad(4.0, 0.0), vec3(0.3, 1.0, sin(time)));\n  }\n\n\n  // animation4\n  p = getAnimationParam(animationParam4, triangleRandom.x);\n  if(p > 0.0) {\n    pos = pos - triangleCenter * p;\n    if(mod(vertexIndex, 3.0) > 0.0) {\n      pos.z += (p * (4.0 * triangleRandom.z * sin(triangleRandom.z * 100.0)));\n      pos = rotateVec3(pos, p * getRad(10.0, triangleRandom.x * 10.0), vec3(1.0, 0, 0));\n      pos = rotateVec3(pos, p * getRad(10.0, triangleRandom.y * 10.0), vec3(0, 1.0, 0));\n      pos += (p * sin(getRad(60.0, noiseValue * 60.0)) * noiseValue * 6.0 * normalize(pos));\n    }\n  }\n\n  // animation5\n  p = getAnimationParam(animationParam5, triangleRandom.x);\n  if(p > 0.0) {\n    pos = pos - (pos - normalize(pos) * 3.0) * p;\n    rad1 = getRad(10.0, triangleRandom.x * 10.0);\n    rad2 = getRad(10.0, triangleRandom.y * 10.0);\n    pos = rotateVec3(pos, p * rad1, vec3(1.0, 0, 0));\n    pos = rotateVec3(pos, p * rad2, vec3(0, 1.0, 0));\n    n = rotateVec3(n, p * rad1, vec3(1.0, 0, 0));\n    n = rotateVec3(n, p * rad2, vec3(0, 1.0, 0));\n    pos += (p * sin(getRad(10.0, triangleRandom.z * 10.0)) * 3.0 * normalize(pos));\n  }\n\n\n  // animation6\n  p = getAnimationParam(animationParam6, triangleRandom.x);\n  if(p > 0.0) {\n    pos = pos - triangleCenter * p;\n    rad1 = getRad(30.0, triangleRandom.x * 10.0);\n    rad2 = getRad(30.0, triangleRandom.y * 10.0);\n    pos = rotateVec3(pos, p * rad1, vec3(1.0, 0, 0));\n    pos = rotateVec3(pos, p * rad2, vec3(0, 1.0, 0));\n    float triangleIndex = floor(vertexIndex / 3.0);\n    float cubeIndex = mod(mod(triangleIndex, 41.0), 3.0);\n    float size = 2.0 + cubeIndex * 2.0;\n    float t = mod(time * 10.0 + triangleRandom.z * 10.0, 4.0);\n    pos.x += (map(t, 0.0, 1.0, -1.0, 1.0, true) * size * p - size * p);\n    pos.y += (map(t, 1.0, 2.0, -1.0, 1.0, true) * size * p - size * p);\n    pos.x -= map(t, 2.0, 3.0, -1.0, 1.0, true) * size * p;\n    pos.y -= map(t, 3.0, 4.0, -1.0, 1.0, true) * size * p;\n    pos.z -= size * p;\n    pos = rotateVec3(pos, p * PI * mod(triangleIndex, 2.0), vec3(1.0, 0, 0));\n    pos = rotateVec3(pos, p * PI / 2.0 * mod(triangleIndex, 3.0), vec3(0, 1.0, 0));\n    pos = rotateVec3(pos, p * PI / 2.0 * mod(triangleIndex, 4.0), vec3(0, 0, 1.00));\n    pos = rotateVec3(pos, p * time * 2.0 * (cubeIndex + 1.0), vec3(1.0, 0, 0));\n    pos = rotateVec3(pos, p * time * 2.0 * (cubeIndex + 1.0), vec3(0, 1.0, 0));\n  }\n\n  // title\n  setTtlAnimation(animationParamTtlAbout, aboutPos, pos);\n  setTtlAnimation(animationParamTtlBlog, blogPos, pos);\n  setTtlAnimation(animationParamTtlBookmarks, bookmarksPos, pos);\n  setTtlAnimation(animationParamTtlWorks, worksPos, pos);\n\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(pos, 1.0);\n\n  float len = length(pos);\n  vColor = vec4(hsv2rgb(vec3(\n    map(sin(getRad(2.0, noiseValue * 0.6 + len * (animationParam5 * 0.2 + animationParam6 * 0.2))), -1.0, 1.0, 0.0, 1.0, true),\n    map(cos(getRad(3.0, noiseValue * 2.0 + len * (animationParam2 * 2.0 + animationParam3 * 3.0))), -1.0, 1.0, 0.3, 0.5, true),\n    map(cos(getRad(1.0, noiseValue * 0.3)), -1.0, 1.0, 1.6, 2.0, true) + animationParam4 * 0.2\n  )), 1.0);\n\n  // light\n  float diffuse  = clamp(dot(n, normalize(vec3(1.0, 1.0, 1.0))) , 0.5, 1.0);\n  vColor *= vec4(vec3(diffuse), 1.0);\n}"},t.shader.PostProcessShader={transparent:!0,uniforms:{time:{type:"f",value:0},noiseCoefficient:{type:"f",value:1},resolution:{type:"v"},texture:{type:"t"}},fragmentShader:"precision mediump float;\nuniform sampler2D texture;\nuniform float noiseCoefficient;\nuniform float time;\nuniform vec2 resolution;\nvarying vec2 vUv;\n\n"+t.shader.simplexNoise2D+"\n\nvoid main(){\n  float noise = simplexNoise2D(gl_FragCoord.xy / resolution.y / 50.0);\n  vec2 texCoord = vec2(\n    vUv.x + (sin((time + noise) * 100.0) * 2.0 / resolution.x) * noiseCoefficient,\n    vUv.y + (cos((time + noise) * 60.0) * 2.0 / resolution.y) * noiseCoefficient\n  );\n  gl_FragColor = texture2D(texture, texCoord);\n}",vertexShader:"attribute vec3 position;\nattribute vec2 uv;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nvarying vec2 vUv;\n\nvoid main() {\n  vUv = uv;\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}"},t.shader.ThumbShader={transparent:!0,side:THREE.DoubleSide,uniforms:{animationParam:{type:"f",value:0},texture:{type:"t"}},fragmentShader:"precision mediump float;\nuniform sampler2D texture;\nvarying vec2 vUv;\n\nvoid main(){\n  gl_FragColor = texture2D(texture, vUv);\n}",vertexShader:"attribute vec3 position;\nattribute vec2 uv;\nattribute float vertexIndex;\nattribute float noiseValue;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform float animationParam;\nvarying vec2 vUv;\n\n"+t.shader.easeInOutExpo+"\n\n"+t.shader.map+"\n\nfloat getAnimationParam(float animationParam, float randomValue) {\n  float p = clamp(-map(randomValue, -1.0, 1.0, 0.0, 0.5, true) + animationParam * 1.6, 0.0, 1.0);\n  p = easeInOutExpo(p, 0.0, 1.0, 1.0);\n  return p;\n}\n\nvoid main() {\n  vUv = uv;\n  vec3 pos = position;\n  float p = getAnimationParam(animationParam, noiseValue);\n  pos.y += p * -120.0;\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(pos, 1.0);\n}"},t.common.Common=function(){function e(){this.update=n(this.update,this),this.startContents=n(this.startContents,this),this.setLoadedContents=n(this.setLoadedContents,this),this.windowResizeHandler=n(this.windowResizeHandler,this),this.$window=$(window),this.$body=$("body"),this.$wrapper=$("#wrapper"),this.$contentsInner=$("#"+r),this.$globalHeader=$("#globalHeader"),this.$globalNav=$("#globalNav"),this.$mainVisual=$("#mainVisual"),this.requestAnimationFrameId=null,this.updateFuncs=[],$("#btnMenu a").on("click",function(t){return function(e){return t.$body.toggleClass("menuOpened"),e.preventDefault(),e.stopImmediatePropagation()}}(this)),this.$mainVisual.find(".btnScroll").on("click",function(t){return function(e){var n;return n=t.$mainVisual.height()-t.$globalHeader.height(),i.windowScrollTo(n,.6),!1}}(this)),this.$wrapper.find(".btnScrollTop").on("click",function(t){return i.windowScrollTo(0,.6),!1}),this.initAsyncTransition(),this.$window.on({popstate:function(t){return function(e){if(t.isInited)return""!==t.lastUrl?(t.registerHistory("",!0),t.showContents(t.lastUrl,location.pathname)):void 0}}(this),scroll:function(t){return function(e){return t.scrollTop=t.$window.scrollTop()}}(this),resize:this.windowResizeHandler}),this.mainVisual=new t.common.MainVisual,t.common.animateToTtl=function(t){return function(e){t.mainVisual.isWebGLSupported&&t.mainVisual.animateToTtl(e)}}(this),t.common.animateFromTtl=function(t){return function(){var e;t.mainVisual.isWebGLSupported&&null!=(e=t.mainVisual)&&e.animateFromTtl()}}(this),this.$window.trigger("resize"),this.$window.trigger("scroll"),this.mainVisual.init(function(t){return function(){var e;return t.mainVisual.isWebGLSupported&&(t.$window.off("resize"),t.$window.on({resize:function(e){t.windowResizeHandler(e),t.mainVisual.resize(t.$window.width(),t.mainVisualHeight-1)},mousemove:t.mainVisual.windowMouseMoveHandler,devicemotion:t.mainVisual.deviceMotionHandler}).trigger("resize"),t.updateFuncs[0]=t.mainVisual.draw),e=$("#loading").addClass("loaded").on(i.TRANSITION_END,function(i){var n;return e.remove(),n=location.pathname,t.registerHistory(n),t.showContents("",n,!0)})}}(this)),t.searchByKeyword=function(t){return function(e,i){t.loadPage("/"+e+"/"+i,null,!0)}}(this),t.back=function(t){return function(e){var i,n;n=t.registerHistory("",!0),i=n.length>0&&n[n.length-1]||e,history.pushState({url:i,lastUrl:t.lastUrl},"",i),t.showContents(t.lastUrl,i)}}(this),this.update()}var a,o,r,s,h;return a=20,s=600,r="contentsInner",h="> .inner",o="contentsContainer",e.prototype.registerHistory=function(t,e){var i;return null==e&&(e=!1),"undefined"!=typeof sessionStorage&&null!==sessionStorage&&(i=this.getHistory(),e?i.pop():i[i.length-1]!==t&&i.push(t),sessionStorage.setItem("history",i.join(",")),i)},e.prototype.getHistory=function(){var t,e;return"undefined"!=typeof sessionStorage&&null!==sessionStorage&&(t=[],e=sessionStorage.getItem("history"),e&&(t=e.split(",")),t)},e.prototype.windowResizeHandler=function(t){return null==t&&(t=null),this.mainVisualHeight=this.$mainVisual.height(),this.headerHeight=this.$globalHeader.height()},e.prototype.initAsyncTransition=function(){var t,e;this.lastUrl="",this.bodyClass="",this.isInited=!1,this.isAnimating=!1,this.$syncItems=null,this.$insertContents=null,this.currentContents=null,this.$currentContentsContainer=this.$contentsInner,this.syncMetaSelectors=["title",'meta[name="keywords"]','meta[name="description"]','meta[property="og:title"]','meta[property="og:url"]','meta[property="og:description"]','meta[property="og:image"]','meta[property="og:type"]'],this.syncStyleSelectors=['link[rel="stylesheet"]:not([href="/assets/css/common.css"])'],t=['[src*="livereload"]','[src*="localhost"]','[src="/assets/js/common.js"]','[src="/assets/js/lib.js"]','[type="text/template"]',".nosync"],this.syncScriptSelectors=["script:not("+t.join(",")+")"],this.$syncStyles=$(this.syncStyleSelectors.join(",")),this.$syncMetas=$(this.syncMetaSelectors.join(",")),this.$syncScripts=$(this.syncScriptSelectors.join(",")),this.getInsertContents(this.$body,!1),e=this,this.$body.on("click",'a[href="#"],a.notransition',function(t){return t.preventDefault(),!1}).on("click",'a:not([target],[href^="#"],[href="#"],a.notransition)',function(t){return e.loadPage($(this).attr("href")),t.preventDefault(),!1}),device.desktop()||this.$globalNav.find("li a").on("click",function(t){var n,a;return e.$body.removeClass("menuOpened"),a=$(this).attr("href"),n=$.Deferred(),e.$globalNav.one(i.TRANSITION_END,function(t){if("globalNav"===t.target.id)return n.resolve()}),e.loadPage(a,n.promise()),t.preventDefault(),t.stopPropagation(),!1})},e.prototype.getInsertContents=function(t,e,i){var n;null==e&&(e=!0),null==i&&(i=!1),n=[].concat(this.syncMetaSelectors,this.syncStyleSelectors,this.syncScriptSelectors,this.syncLinks).join(","),n=n.replace(/,$/,""),e?this.$syncItems=t.filter(n):this.$syncItems=$(n).clone(),i?this.$insertContents=t.find("#"+r+" "+h).children():this.$insertContents=t.find("#"+r).children()},e.prototype.loadPage=function(t,e,i){var n;null==e&&(e=null),null==i&&(i=!1),this.isAnimating||(t=this.removeHostsFromUrl(t),n=location.pathname,(t!==n||i)&&(history.pushState({url:t,lastUrl:this.lastUrl},"",t),this.registerHistory(t),this.showContents(n,t,!1,e)))},e.prototype.ajaxPageLoad=function(t,e){return null==e&&(e=!1),axios.get(t).then(function(t){return function(i){var n,a;return 200===i.status?(a=i.data,t.bodyClass=a.match(/<body[^<>'"]*class="(.*)"/)[1],n=$(a.replace(/([.\s\S　]*)<html([^>]*)>([.\s\S　]*)<\/html>/,"$3")),t.getInsertContents(n,!0,e)):log("ajax error",i.statusText)}}(this))["catch"](function(t){return log("ajax error",t)})},e.prototype.setLoadedContents=function(){var t,e,i,n,a,o,r,s,h;return o=$.Deferred(),h=this,s=0,r=0,this.$body.attr("class",this.bodyClass),a=function(t){return function(e){null==e&&(e=null),0!==s&&++r!==s||(t.$syncScripts.remove(),t.$syncScripts=$(t.syncScriptSelectors.join(",")),t.$syncStyles.remove(),t.$syncStyles=$(t.syncStyleSelectors.join(",")),t.$window.resize().scroll(),o.resolve())}}(this),$.each(this.syncMetaSelectors,function(t){return function(e){var i,n;n=t.syncMetaSelectors[e],i=t.$syncMetas.filter(n),i.attr("content")?i.attr("content",t.$syncItems.filter(n).attr("content")):i.text(t.$syncItems.filter(n).text())}}(this)),e=$('link[rel="stylesheet"]').last(),n=null,$.each(this.syncStyleSelectors,function(t){return function(i){var o;o=t.syncStyleSelectors[i],n=t.$syncItems.filter(o),n.each(function(t){var i,o;o=n.eq(t),i=$("<link>").insertAfter(e).one("load",function(t){return a()}).attr({rel:"stylesheet",type:"text/css",href:o.attr("href"),media:o.attr("media")})}),s+=n.length}}(this)),t=$("script").last(),i=null,$.each(this.syncScriptSelectors,function(e){return function(n){var o;o=e.syncScriptSelectors[n],i=e.$syncItems.filter(o),i.each(function(e){var n,o,r;o=i.eq(e),r=o.attr("src"),n=$("<script>").insertAfter(t).attr("type","text/javascript"),null!=r?n.one("load",function(t){a()}).attr("src",r):(n.html(o.html()),setTimeout(function(){return a()},400))}),s+=i.length}}(this)),this.$currentContentsContainer.children().remove(),this.$currentContentsContainer.html(this.$insertContents),o.promise()},e.prototype.removeHostsFromUrl=function(t){var e;return t.indexOf(location.host)>=0?(e=new RegExp(location.protocol+"//"+location.host),t.replace(e,"")):t},e.prototype.showContents=function(t,e,i,n){var a,r,s,u,l,c,d;if(null==i&&(i=!1),null==n&&(n=null),e=this.removeHostsFromUrl(e),!this.isAnimating&&t!==e)return this.$currentContentsContainer=this.$contentsInner,this.lastUrl=e,this.isAnimating=!0,u=this.getPathArr(t),l=this.getPathArr(e),a=u[0],r=l[0],i?(this.isInited=!0,void this.startContents(!0)):(""===r&&this.$body.addClass("hiding"),s=!1,d=0,a===r&&(s=!0,this.$currentContentsContainer=this.$contentsInner.find(h),d=this.$window.height()-this.$globalHeader.height(),this.$contentsInner.css("height",this.$contentsInner.outerHeight())),this.$currentContentsContainer.addClass(o),c=[this.ajaxPageLoad(this.lastUrl,s),this.fadeOutContents(d)],n&&c.push(n),$.when.apply(this,c).then(function(t){return function(){return t.setLoadedContents()}}(this)).then(function(t){return function(){return"function"==typeof ga&&ga("send","pageview",e),t.startContents()}}(this)),void 0)},e.prototype.startContents=function(e){var i;return null==e&&(e=!1),this.$body.addClass("show").removeClass("hide"),this.currentContents=t.common.currentContents,this.currentContents.init(),i=function(t){return function(e){null==e&&(e=null),t.$contentsInner.css("height",""),t.$wrapper.removeClass("hiding"),t.currentContents.start(),t.isAnimating=!1}}(this),e?void i():void TweenMax.to(this.$currentContentsContainer,.2,{opacity:1,delay:.2,ease:Linear.easeNone,onComplete:function(t){return function(){t.$currentContentsContainer.removeClass(o),i()}}(this)})},e.prototype.fadeOutContents=function(t){var e;return e=$.Deferred(),this.$body.addClass("hide").removeClass("show"),i.windowScrollTo(t).then(function(t){return function(){return TweenMax.to(t.$currentContentsContainer,.2,{opacity:0,ease:Linear.easeNone,onComplete:function(){t.currentContents&&t.currentContents.reset(),e.resolve()}})}}(this)),e.promise()},e.prototype.getPathArr=function(t){var e;return e=t.split("/"),e.splice(0,1),1!==e.length&&""===e[e.length-1]&&e.pop(),e},e.prototype.update=function(){var t,e,i,n;for(this.scrollTop>=this.mainVisualHeight-this.headerHeight?this.$body.addClass("scrolled"):this.$body.removeClass("scrolled"),n=this.updateFuncs,e=0,i=n.length;e<i;e++)t=n[e],"function"==typeof t&&t();return this.requestAnimationFrameId=requestAnimationFrame(this.update)},e}(),t.common.Contents=function(){function e(){this.resizeSearchPanel=n(this.resizeSearchPanel,this),t.common.currentContents=this}return e.prototype.reset=function(){},e.prototype.start=function(){},e.prototype.init=function(){this.$window=$(window),this.$body=$("body"),this.$contents=$("#contents"),this.$contentsInner=$("#contentsInner"),this.$mainVisual=$("#mainVisual"),this.$globalHeader=$("#globalHeader")},e.prototype.initThumbs=function(){this.initImgs(".articles .thumb img")},e.prototype.initImgs=function(t){this.$contentsInner.find(t).each(function(t,e){return i.preloadImg(e.src).then(function(){return $(e).one(i.TRANSITION_END,function(t){return t.stopPropagation(),!1}).addClass("loaded")})})},e.prototype.initThumbsInteraction=function(e,i,n){var a;null==i&&(i=10),null==n&&(n=10),device.desktop()&&(a=this,this.thumbs=[],this.$contentsInner.find(e).each(function(e,o){var r;return r=new t.common.Thumb($(this),i,n),a.thumbs.push(r),r.init()}))},e.prototype.disposeThumbsInteraction=function(){var t,e,i,n;if(device.desktop())for(i=this.thumbs,t=0,e=i.length;t<e;t++)n=i[t],n.dispose()},e.prototype.initBtnBack=function(e){this.$btnBack=this.$searchPanel.find(".btnBack").on("click",function(i){return function(i){return t.back("/"+e+"/"),i.preventDefault(),!1}}(this))},e.prototype.resetBtnBack=function(){this.$btnBack.off("click")},e.prototype.initSearchPanel=function(e){var i,n;this.$searchPanel=$("#searchPanel"),this.$categories=this.$searchPanel.find(".categories"),this.$tags=this.$searchPanel.find(".tags"),this.$monthlyArchives=this.$searchPanel.find(".monthlyArchives"),this.$keyword=this.$searchPanel.find(".keyword"),i=this.$keyword.find("input"),this.$keyword.find(".btnSubmit").on("click",function(n){return function(n){return t.searchByKeyword(e,"?s="+i.val()),n.preventDefault(),!1}}(this)),n=function(t){return function(t,e,i){return null==i&&(i=!0),i?(t.toggleClass("closed"),e.toggleClass("closed")):(t.addClass("closed"),e.addClass("closed"))}}(this),this.$btnCategories=this.$searchPanel.find(".btnCategories").on("click",function(t){return function(e){return n(t.$btnCategories,t.$categories),n(t.$btnTags,t.$tags,!1),n(t.$btnMonthlyArchives,t.$monthlyArchives,!1),n(t.$btnKeyword,t.$keyword,!1),!1}}(this)),this.$btnTags=this.$searchPanel.find(".btnTags").on("click",function(t){return function(e){return n(t.$btnCategories,t.$categories,!1),n(t.$btnTags,t.$tags),n(t.$btnMonthlyArchives,t.$monthlyArchives,!1),n(t.$btnKeyword,t.$keyword,!1),!1}}(this)),this.$btnMonthlyArchives=this.$searchPanel.find(".btnMonthlyArchives").on("click",function(t){return function(e){return n(t.$btnCategories,t.$categories,!1),n(t.$btnTags,t.$tags,!1),n(t.$btnMonthlyArchives,t.$monthlyArchives),n(t.$btnKeyword,t.$keyword,!1),!1}}(this)),this.$btnKeyword=this.$searchPanel.find(".btnKeyword").on("click",function(t){return function(e){return n(t.$btnCategories,t.$categories,!1),n(t.$btnTags,t.$tags,!1),n(t.$btnMonthlyArchives,t.$monthlyArchives,!1),n(t.$btnKeyword,t.$keyword),!1}}(this))},e.prototype.resizeSearchPanel=function(){this.$categories.css("height",this.$categories.find("ul").outerHeight()),this.$tags.css("height",this.$tags.find("ul").outerHeight()),this.$monthlyArchives.css("height",this.$monthlyArchives.find("ul").outerHeight()),this.$keyword.css("height",this.$keyword.find("form").outerHeight())},e.prototype.resetSearchPanel=function(){this.$btnCategories.off("click"),this.$btnTags.off("click"),this.$btnMonthlyArchives.off("click"),this.$btnKeyword.off("click")},e}(),t.common.MainVisual=function(){function e(){this.deviceMotionHandler=n(this.deviceMotionHandler,this),this.windowMouseMoveHandler=n(this.windowMouseMoveHandler,this),this.resize2=n(this.resize2,this),this.resize=n(this.resize,this),this.resizeMainMesh=n(this.resizeMainMesh,this),this.draw2=n(this.draw2,this),this.draw=n(this.draw,this),this.$container=$("#mainVisual"),this.$canvas=this.$container.find("canvas"),this.width=100,this.height=100,this.isWebGLSupported=!1,this.sensorAxisDir=-1,(i.isiPhone||i.isiPad)&&(this.sensorAxisDir=1)}var a,o,r;return a=20,o=100,r={about:"/assets/img/headerTtlAbout.png",blog:"/assets/img/headerTtlBlog.png",bookmarks:"/assets/img/headerTtlBookmarks.png",works:"/assets/img/headerTtlWorks.png"},e.prototype.init=function(t){return Detector.webgl?this.initWebGL(t):(log("not supported"),"function"==typeof t?t():void 0)},e.prototype.initWebGL=function(e){var i;this.isWebGLSupported=!0,this.renderer=new THREE.WebGLRenderer({canvas:this.$canvas.get(0),alpha:!0,antialias:!0}),i=Math.min(window.devicePixelRatio||1,2),this.renderer.setPixelRatio(i),this.bufferScene=new THREE.Scene,this.bufferCamera=new THREE.PerspectiveCamera(45,this.width/this.height,1,1e3),this.bufferCamera.position.set(0,0,a),this.bufferScene.add(this.bufferCamera),this.bufferCameraDefaultPos=this.bufferCamera.position.clone(),
this.bufferCameraMatrix=new THREE.Matrix4,this.takumiObject3D=new t.common.TakumiObject3D,this.takumiObject3D.setTtlScale(this.width,this.height),this.bufferScene.add(this.takumiObject3D),device.desktop()?this.initFullVersion():this.initSimpleVersion(),$.when(this.initTtlImg("about"),this.initTtlImg("blog"),this.initTtlImg("bookmarks"),this.initTtlImg("works")).then(function(){return"function"==typeof e?e():void 0})},e.prototype.initTtlImg=function(t){var e,i,n;return i=$.Deferred(),n=r[t],e=$("<img>").one("load",function(n){return function(a){var o,r,s,h,u,l,c,d,m,f;for(u=e.get(0),r=document.createElement("canvas"),s=r.getContext("2d"),r.width=u.width,r.height=u.height,s.drawImage(u,0,0,u.width,u.height),l=s.getImageData(0,0,u.width,u.height),m=[],h=d=0,f=l.data.length-1;d<f;h=d+=4)o=l.data[h+3],c=h/4,o>0&&m.push({x:c%u.width-u.width/2,y:u.height/2-Math.floor(c/u.width)});return n.takumiObject3D.addAttributeFromImgData(t,m),i.resolve()}}(this)).attr("src",n),i.promise()},e.prototype.animateToTtl=function(t){if(this.clearToggleAnimationTimer(),this.takumiObject3D.animateToTtl(t),null!=this.mainMesh)return TweenMax.to(this.mainMesh.material.uniforms.noiseCoefficient,1,{overwrite:!0,value:10,ease:Expo.easeOut,delay:1})},e.prototype.animateFromTtl=function(){if(this.setToggleAnimationTimer(),this.takumiObject3D.animateFromTtl(),null!=this.mainMesh)return TweenMax.to(this.mainMesh.material.uniforms.noiseCoefficient,2,{overwrite:!0,value:0,ease:Expo.easeOut})},e.prototype.setToggleAnimationTimer=function(){return this.toggleAnimationTimerId=setInterval(function(t){return function(){return t.takumiObject3D.toggleAnimation()}}(this),1e4)},e.prototype.clearToggleAnimationTimer=function(){return clearTimeout(this.toggleAnimationTimerId)},e.prototype.initFullVersion=function(){return this.buffer=new THREE.WebGLRenderTarget(this.width,this.height,{magFilter:THREE.NearestFilter,minFilter:THREE.NearestFilter,wrapS:THREE.ClampToEdgeWrapping,wrapT:THREE.ClampToEdgeWrapping}),this.scene=new THREE.Scene,this.camera=new THREE.OrthographicCamera(-this.textureWidth/2,this.textureWidth/2,this.textureHeight/2,-this.textureHeight/2,(-10),10),this.camera.target=new THREE.Vector3(0,0,0),this.camera.position.z=10,this.mainMesh=new THREE.Mesh(new THREE.PlaneGeometry(o,o),new THREE.RawShaderMaterial(t.shader.PostProcessShader)),this.mainMesh.material.uniforms.texture.value=this.buffer.texture,this.mainMesh.material.uniforms.resolution.value=new THREE.Vector2(this.width,this.height),this.resizeMainMesh(),this.scene.add(this.mainMesh),this.noiseCoefficient=0,this.mainMesh.material.uniforms.noiseCoefficient.value=this.noiseCoefficient},e.prototype.initSimpleVersion=function(){return this.draw=this.draw2,this.resize=this.resize2},e.prototype.draw=function(){this.takumiObject3D.update(),this.mainMesh.material.uniforms.time.value+=.001,this.renderer.render(this.bufferScene,this.bufferCamera,this.buffer),this.renderer.render(this.scene,this.camera)},e.prototype.draw2=function(){return this.takumiObject3D.update(),this.renderer.render(this.bufferScene,this.bufferCamera)},e.prototype.resizeMainMesh=function(){this.mainMesh.scale.set(this.width/o,this.height/o,1)},e.prototype.resize=function(t,e){this.width=t,this.height=e,this.bufferCamera.aspect=this.width/this.height,this.bufferCamera.updateProjectionMatrix(),this.buffer.setSize(this.width,this.height),this.takumiObject3D.setTtlScale(this.width,this.height),this.resizeMainMesh(),this.mainMesh.material.uniforms.resolution.value.x=this.width,this.mainMesh.material.uniforms.resolution.value.y=this.height,this.camera.left=-this.width/2,this.camera.right=this.width/2,this.camera.top=this.height/2,this.camera.bottom=-this.height/2,this.camera.updateProjectionMatrix(),this.renderer.setSize(this.width,this.height)},e.prototype.resize2=function(t,e){this.width=t,this.height=e,this.bufferCamera.aspect=this.width/this.height,this.bufferCamera.updateProjectionMatrix(),this.renderer.setSize(this.width,this.height),this.takumiObject3D.setTtlScale(this.width,this.height)},e.prototype.windowMouseMoveHandler=function(t){var e,n;e=i.map(t.pageX/this.width,0,1,-1,1),n=i.map(t.pageY/this.height,0,1,-1,1),this.setBufferCameraPos(e,n),this.isMoved=!0},e.prototype.deviceMotionHandler=function(t){var e,i;e=t.originalEvent.accelerationIncludingGravity.x/4,i=t.originalEvent.accelerationIncludingGravity.y/4,this.setBufferCameraPos(e*this.sensorAxisDir,i*this.sensorAxisDir)},e.prototype.setBufferCameraPos=function(t,e){var i;i=this.bufferCameraDefaultPos.clone(),this.bufferCameraMatrix.identity(),this.bufferCameraMatrix.makeRotationX(e*Math.PI/6),i.applyMatrix4(this.bufferCameraMatrix),this.bufferCameraMatrix.makeRotationY(t*Math.PI/6),i.applyMatrix4(this.bufferCameraMatrix),TweenMax.to(this.bufferCamera.position,3,{overwrite:!0,x:i.x,y:i.y,z:i.z,ease:Expo.easeOut,onUpdate:function(t){return function(){return t.bufferCamera.lookAt(new THREE.Vector3)}}(this)})},e}(),t.common.TakumiGeometry=function(t){function e(t){var i,a,o,r,s,h,u,l,c,d,m,f,p,b,g,v,y,w,H,x,W,$,C,T,P,R,k,M,A,S,V,E,I,z,D;for(this.cubeWidth=null!=t?t:1,e.__super__.constructor.call(this),this.cubeWidthHalf=this.cubeWidth/2,this.takumiWidth=17*this.cubeWidth,this.takumiHeight=22*this.cubeWidth,this.takumiDepth=n*this.cubeWidth,this.takumiWidthHalf=this.takumiWidth/2,this.takumiHeightHalf=this.takumiHeight/2,this.takumiDepthHalf=this.takumiDepth/2,this.vertices=[],this.vertexIndices=[],this.cubeCenters=[],this.cubeRandoms=[],this.triangleRandoms=[],this.triangleCenters=[],this.noiseValues=[],D=H=0;H<7;D=++H)for(w=x=0;x<3;w=++x)for(y=W=0,R=n;0<=R?W<R:W>R;y=0<=R?++W:--W)this.addCubeVertices(D*this.cubeWidth-this.takumiWidthHalf+this.cubeWidthHalf,w*-this.cubeWidth+this.takumiHeightHalf-this.cubeWidthHalf,y*-this.cubeWidth+this.takumiDepthHalf-this.cubeWidthHalf);for(D=$=0;$<3;D=++$)for(w=C=0;C<14;w=++C)for(y=T=0,k=n;0<=k?T<k:T>k;y=0<=k?++T:--T)this.addCubeVertices(D*this.cubeWidth-this.takumiWidthHalf+this.cubeWidthHalf+2*this.cubeWidth,w*-this.cubeWidth+this.takumiHeightHalf-this.cubeWidthHalf-4*this.cubeWidth,y*-this.cubeWidth+this.takumiDepthHalf-this.cubeWidthHalf);for(D=P=0;P<7;D=++P)for(w=z=0;z<3;w=++z)for(y=i=0,M=n;0<=M?i<M:i>M;y=0<=M?++i:--i)this.addCubeVertices(D*this.cubeWidth-this.takumiWidthHalf+this.cubeWidthHalf,w*-this.cubeWidth+this.takumiHeightHalf-this.cubeWidthHalf-19*this.cubeWidth,y*-this.cubeWidth+this.takumiDepthHalf-this.cubeWidthHalf);for(D=a=0;a<9;D=++a)for(w=o=0;o<3;w=++o)for(y=r=0,A=n;0<=A?r<A:r>A;y=0<=A?++r:--r)this.addCubeVertices(D*this.cubeWidth-this.takumiWidthHalf+this.cubeWidthHalf+8*this.cubeWidth,w*-this.cubeWidth+this.takumiHeightHalf-this.cubeWidthHalf,y*-this.cubeWidth+this.takumiDepthHalf-this.cubeWidthHalf);for(D=s=0;s<3;D=++s)for(w=h=0;h<3;w=++h)for(y=u=0,S=n;0<=S?u<S:u>S;y=0<=S?++u:--u)this.addCubeVertices(D*this.cubeWidth-this.takumiWidthHalf+this.cubeWidthHalf+10*this.cubeWidth,w*-this.cubeWidth+this.takumiHeightHalf-this.cubeWidthHalf-4*this.cubeWidth,y*-this.cubeWidth+this.takumiDepthHalf-this.cubeWidthHalf);for(D=l=0;l<7;D=++l)for(w=c=0;c<3;w=++c)for(y=d=0,V=n;0<=V?d<V:d>V;y=0<=V?++d:--d)this.addCubeVertices(D*this.cubeWidth-this.takumiWidthHalf+this.cubeWidthHalf+10*this.cubeWidth,w*-this.cubeWidth+this.takumiHeightHalf-this.cubeWidthHalf-8*this.cubeWidth,y*-this.cubeWidth+this.takumiDepthHalf-this.cubeWidthHalf);for(D=m=0;m<3;D=++m)for(w=f=0;f<6;w=++f)for(y=p=0,E=n;0<=E?p<E:p>E;y=0<=E?++p:--p)this.addCubeVertices(D*this.cubeWidth-this.takumiWidthHalf+this.cubeWidthHalf+14*this.cubeWidth,w*-this.cubeWidth+this.takumiHeightHalf-this.cubeWidthHalf-12*this.cubeWidth,y*-this.cubeWidth+this.takumiDepthHalf-this.cubeWidthHalf);for(D=b=0;b<9;D=++b)for(w=g=0;g<3;w=++g)for(y=v=0,I=n;0<=I?v<I:v>I;y=0<=I?++v:--v)this.addCubeVertices(D*this.cubeWidth-this.takumiWidthHalf+this.cubeWidthHalf+8*this.cubeWidth,w*-this.cubeWidth+this.takumiHeightHalf-this.cubeWidthHalf-19*this.cubeWidth,y*-this.cubeWidth+this.takumiDepthHalf-this.cubeWidthHalf);this.addAttribute("position",new THREE.BufferAttribute(new Float32Array(this.vertices),3)),this.addAttribute("vertexIndex",new THREE.BufferAttribute(new Uint16Array(this.vertexIndices),1)),this.addAttribute("cubeCenter",new THREE.BufferAttribute(new Float32Array(this.cubeCenters),3)),this.addAttribute("cubeRandom",new THREE.BufferAttribute(new Float32Array(this.cubeRandoms),3)),this.addAttribute("triangleCenter",new THREE.BufferAttribute(new Float32Array(this.triangleCenters),3)),this.addAttribute("triangleRandom",new THREE.BufferAttribute(new Float32Array(this.triangleRandoms),3)),this.addAttribute("noiseValue",new THREE.BufferAttribute(new Float32Array(this.noiseValues),1)),this.computeVertexNormals(),delete this.vertices,delete this.cubeCenters,delete this.vertexIndices,delete this.cubeRandoms,delete this.triangleRandoms,delete this.noiseValues}var n;return a(e,t),n=4,e.prototype.addAttributeFromImgData=function(t,e){var i,n,a,o,r,s,h;for(s=this.attributes.vertexIndex.count/3,s>e.length&&(e=e.concat(e)),e=_.sample(e,s),i=[],a=0,r=e.length;a<r;a++)for(h=e[a],n=o=0;o<3;n=++o)i.push(h.x),i.push(h.y);this.addAttribute(t+"Pos",new THREE.BufferAttribute(new Float32Array(i),2)),i=null},e.prototype.addCubeVertices=function(t,e,i){var n,a,o,r,s,h,u,l;for(null==t&&(t=0),null==e&&(e=0),null==i&&(i=0),o=new THREE.BufferGeometry,this.cubeWidthHalf=this.cubeWidth/2,a=[-this.cubeWidthHalf+t,-this.cubeWidthHalf+e,this.cubeWidthHalf+i,this.cubeWidthHalf+t,-this.cubeWidthHalf+e,this.cubeWidthHalf+i,this.cubeWidthHalf+t,this.cubeWidthHalf+e,this.cubeWidthHalf+i,this.cubeWidthHalf+t,this.cubeWidthHalf+e,this.cubeWidthHalf+i,-this.cubeWidthHalf+t,this.cubeWidthHalf+e,this.cubeWidthHalf+i,-this.cubeWidthHalf+t,-this.cubeWidthHalf+e,this.cubeWidthHalf+i,-this.cubeWidthHalf+t,this.cubeWidthHalf+e,-this.cubeWidthHalf+i,this.cubeWidthHalf+t,this.cubeWidthHalf+e,-this.cubeWidthHalf+i,this.cubeWidthHalf+t,-this.cubeWidthHalf+e,-this.cubeWidthHalf+i,this.cubeWidthHalf+t,-this.cubeWidthHalf+e,-this.cubeWidthHalf+i,-this.cubeWidthHalf+t,-this.cubeWidthHalf+e,-this.cubeWidthHalf+i,-this.cubeWidthHalf+t,this.cubeWidthHalf+e,-this.cubeWidthHalf+i,-this.cubeWidthHalf+t,this.cubeWidthHalf+e,this.cubeWidthHalf+i,this.cubeWidthHalf+t,this.cubeWidthHalf+e,this.cubeWidthHalf+i,this.cubeWidthHalf+t,this.cubeWidthHalf+e,-this.cubeWidthHalf+i,this.cubeWidthHalf+t,this.cubeWidthHalf+e,-this.cubeWidthHalf+i,-this.cubeWidthHalf+t,this.cubeWidthHalf+e,-this.cubeWidthHalf+i,-this.cubeWidthHalf+t,this.cubeWidthHalf+e,this.cubeWidthHalf+i,-this.cubeWidthHalf+t,-this.cubeWidthHalf+e,-this.cubeWidthHalf+i,this.cubeWidthHalf+t,-this.cubeWidthHalf+e,-this.cubeWidthHalf+i,this.cubeWidthHalf+t,-this.cubeWidthHalf+e,this.cubeWidthHalf+i,this.cubeWidthHalf+t,-this.cubeWidthHalf+e,this.cubeWidthHalf+i,-this.cubeWidthHalf+t,-this.cubeWidthHalf+e,this.cubeWidthHalf+i,-this.cubeWidthHalf+t,-this.cubeWidthHalf+e,-this.cubeWidthHalf+i,-this.cubeWidthHalf+t,-this.cubeWidthHalf+e,-this.cubeWidthHalf+i,-this.cubeWidthHalf+t,-this.cubeWidthHalf+e,this.cubeWidthHalf+i,-this.cubeWidthHalf+t,this.cubeWidthHalf+e,this.cubeWidthHalf+i,-this.cubeWidthHalf+t,this.cubeWidthHalf+e,this.cubeWidthHalf+i,-this.cubeWidthHalf+t,this.cubeWidthHalf+e,-this.cubeWidthHalf+i,-this.cubeWidthHalf+t,-this.cubeWidthHalf+e,-this.cubeWidthHalf+i,this.cubeWidthHalf+t,-this.cubeWidthHalf+e,-this.cubeWidthHalf+i,this.cubeWidthHalf+t,this.cubeWidthHalf+e,-this.cubeWidthHalf+i,this.cubeWidthHalf+t,-this.cubeWidthHalf+e,this.cubeWidthHalf+i,this.cubeWidthHalf+t,this.cubeWidthHalf+e,this.cubeWidthHalf+i,this.cubeWidthHalf+t,-this.cubeWidthHalf+e,this.cubeWidthHalf+i,this.cubeWidthHalf+t,this.cubeWidthHalf+e,-this.cubeWidthHalf+i],n=[this.getRandomValue(),this.getRandomValue(),this.getRandomValue()],r=s=0;s<36;r=++s)this.vertexIndices.push(this.vertexIndices.length),this.cubeRandoms.push(n[0]),this.cubeRandoms.push(n[1]),this.cubeRandoms.push(n[2]),this.cubeCenters.push(t),this.cubeCenters.push(e),this.cubeCenters.push(i),l=new THREE.Vector3(a[3*r],a[3*r+1],a[3*r+2]),l.normalize(),this.noiseValues.push(PerlinNoise.noise(l.x,l.y,l.z)),r%3===0&&(u=[Math.random(),Math.random(),Math.random()],h=[(a[3*r]+a[3*r+3]+a[3*r+6])/3,(a[3*r+1]+a[3*r+1+3]+a[3*r+1+6])/3,(a[3*r+2]+a[3*r+2+3]+a[3*r+2+6])/3]),this.triangleRandoms.push(this.getRandomValue2(u[0],.01)),this.triangleRandoms.push(this.getRandomValue2(u[1],.01)),this.triangleRandoms.push(this.getRandomValue2(u[2],.01)),this.triangleCenters.push(h[0]),this.triangleCenters.push(h[1]),this.triangleCenters.push(h[2]);return Array.prototype.push.apply(this.vertices,a)},e.prototype.getRandomValue=function(){return i.map(Math.random(),0,1,-1,1)},e.prototype.getRandomValue2=function(t,e){return i.map(t-Math.random()*e,0,1,-1,1)},e}(THREE.BufferGeometry),t.common.TakumiObject3D=function(e){function n(){n.__super__.constructor.call(this),this.geometry=new t.common.TakumiGeometry(.4),this.material=new THREE.RawShaderMaterial(t.shader.TakumiShader),this.takumiMesh=new THREE.Mesh(this.geometry,this.material),this.animationNoArr=[],this.currentAnimationNo=this.getNextAnimationNo(),this.material.uniforms["animationParam"+this.currentAnimationNo].value=1,this.add(this.takumiMesh)}var o,r;return a(n,e),o=6,r=["about","blog","bookmarks","works"],n.prototype.setTtlScale=function(t,e){var i;i=t/1200*.08,device.mobile()&&(i*=2),this.material.uniforms.ttlScale.value=i},n.prototype.update=function(){this.material.uniforms.time.value+=.001},n.prototype.backToAnimation1=function(){this.animate(this.currentAnimationNo,0),this.animate(1,1),this.currentAnimationNo=1},n.prototype.animateTo=function(t){this.currentAnimationNo=t,this.animate(1,0),this.animate(this.currentAnimationNo,1)},n.prototype.animateToTtl=function(t){var e,n,a,s,h,u,l;for(e=n=1,u=o;1<=u?n<=u:n>=u;e=1<=u?++n:--n)this.animate(e,0,2);for(a=0,s=r.length;a<s;a++)l=r[a],h=l===t?1:0,this.animate("Ttl"+i.toCap(l),h,2)},n.prototype.animateFromTtl=function(){var t,e,n;for(this.animate(this.currentAnimationNo,1,2),t=0,e=r.length;t<e;t++)n=r[t],this.animate("Ttl"+i.toCap(n),0,2)},n.prototype.toggleAnimation=function(){return 1===this.currentAnimationNo?this.animateTo(this.getNextAnimationNo()):void this.backToAnimation1()},n.prototype.getNextAnimationNo=function(){return 0===this.animationNoArr.length&&(this.animationNoArr=_.chain(_.range(2,o+1)).shuffle().value()),this.animationNoArr.shift()},n.prototype.animate=function(t,e,i){return null==i&&(i=3),t=t.toString(),TweenMax.to(this.material.uniforms["animationParam"+t],i,{overwrite:!0,value:e,ease:Linear.easeNone})},n.prototype.addAttributeFromImgData=function(t,e){return this.geometry.addAttributeFromImgData(t,e)},n}(THREE.Object3D),t.common.Thumb=function(){function e(t,e,i){this.$container=t,this.widthSegments=null!=e?e:20,this.heightSegments=null!=i?i:10,this.resize=n(this.resize,this),this.draw=n(this.draw,this),this.isWebGLSupported=!1}var a;return a=100,e.prototype.init=function(t){Detector.webgl?this.initWebGL(t):(log("not supported"),"function"==typeof t&&t())},e.prototype.initWebGL=function(e){var n,o,r,s,h,u,l,c;for(this.isWebGLSupported=!0,this.width=this.$container.outerWidth(),this.height=this.$container.outerHeight(),this.renderer=new THREE.WebGLRenderer({alpha:!0,antialias:!0}),this.$container.get(0).appendChild(this.renderer.domElement),l=Math.min(window.devicePixelRatio||1,2),this.renderer.setPixelRatio(l),this.scene=new THREE.Scene,this.camera=new THREE.PerspectiveCamera(45,this.width/this.height,1,1e3),this.camera.position.set(0,0,1),this.scene.add(this.camera),u=(this.widthSegments+1)*(this.heightSegments+1),h=[],o=s=0,c=u;0<=c?s<c:s>c;o=0<=c?++s:--s)h.push(i.map(Math.random(),0,1,-1,1,!0));this.geometry=new THREE.PlaneBufferGeometry(a,a,this.widthSegments,this.heightSegments),this.geometry.addAttribute("vertexIndex",new THREE.BufferAttribute(new Uint16Array(_.range(u)),1)),this.geometry.addAttribute("noiseValue",new THREE.BufferAttribute(new Float32Array(h),1)),h=null,this.material=new THREE.RawShaderMaterial($.extend(!0,{},t.shader.ThumbShader)),this.mesh=new THREE.Mesh(this.geometry,this.material),this.scene.add(this.mesh),n=this.$container.find("img"),r=n.attr("src"),this.material.uniforms.texture.value=(new THREE.TextureLoader).load(r,function(t){return function(e){return t.resize(),t.draw(),n.remove(),n=null,t.$container.find(".detail").remove()}}(this)),this.$container.on({mouseover:function(t){return function(){return TweenMax.to(t.material.uniforms.animationParam,1.4,{value:1,ease:Linear.easeNone,overwrite:!0,onUpdate:function(){return t.draw()}})}}(this),mouseout:function(t){return function(){return TweenMax.to(t.material.uniforms.animationParam,1.4,{value:0,ease:Linear.easeNone,overwrite:!0,onUpdate:function(){return t.draw()}})}}(this)})},e.prototype.draw=function(){this.renderer.render(this.scene,this.camera)},e.prototype.resizeMesh=function(){this.mesh.scale.set(this.width/a,this.height/a,1)},e.prototype.dispose=function(){this.$container.off("mouseover"),this.$container.off("mouseout"),this.geometry.dispose(),this.material.uniforms.texture.value.dispose(),this.material.dispose(),this.scene.remove(this.mesh),this.scene.remove(this.camera),this.renderer.dispose()},e.prototype.resize=function(){var t;this.width=this.$container.outerWidth(),this.height=this.$container.outerHeight(),this.camera.aspect=this.width/this.height,this.camera.updateProjectionMatrix(),t=-(this.height/2)/Math.tan(this.camera.fov*Math.PI/180/2),this.camera.position.set(0,0,-t),this.resizeMesh(),this.renderer.setSize(this.width,this.height)},e}(),$(function(){return new t.common.Common})}).call(this);